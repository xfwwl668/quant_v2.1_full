# config.yaml
# =============
# 高性能量化回测系统 v2.0.1 配置文件
#
# 说明：
#   - 所有配置项都有默认值（src/constants.py）
#   - 可以通过环境变量覆盖（前缀 QUANT_）
#   - 修改后需重启系统生效

# ============================================================================
# 系统配置
# ============================================================================
environment: production  # production / development
enable_performance_monitoring: false


# ============================================================================
# 数据配置
# ============================================================================
data:
  base_dir: "./data"  # 数据根目录（Path Hijacking 契约源）
  enable_collector: true
  enable_sanitizer: true
  
  # TDX 采集器配置
  collector_max_workers: 15       # 并发线程数（建议 15-20）
  collector_timeout: 5.0          # 连接超时（秒）
  collector_enable_adjust: true   # 启用前复权
  collector_enable_async_log: true  # 高并发必须启用
  
  # 数据清洗配置
  sanitizer_price_threshold: 3.0   # 价格异常值 MAD 阈值
  sanitizer_volume_threshold: 5.0  # 成交量异常值 MAD 阈值


# ============================================================================
# 因子配置
# ============================================================================
factor:
  # RSRS 因子参数
  rsrs_window: 18          # 回归窗口
  rsrs_zscore_window: 600  # Z-Score 标准化窗口
  rsrs_momentum_window: 5  # 动量窗口
  rsrs_r2_threshold: 0.8   # 有效性阈值


# ============================================================================
# 账户配置
# ============================================================================
account:
  initial_cash: 1000000.0            # 初始资金（100 万）
  max_positions: 20                  # 最大持仓数
  max_single_position_ratio: 0.10    # 单股最大权重（10%）
  max_total_position_ratio: 0.95     # 总仓位上限（95%）


# ============================================================================
# 交易成本配置
# ============================================================================
trading_cost:
  commission_rate: 0.0003              # 佣金费率（万三）
  min_commission: 5.0                  # 最低佣金（5 元）
  slippage_base: 0.0001                # 基础滑点（万一）
  slippage_volume_scale: 0.001         # 成交量冲击系数
  slippage_volatility_scale: 0.3       # 波动率冲击系数
  max_slippage: 0.05                   # 最大滑点保护（5%）


# ============================================================================
# 回测配置
# ============================================================================
backtest:
  start_date: "2020-01-01"  # 回测起始日期
  end_date: "2024-12-31"    # 回测结束日期
  benchmark: "000300"       # 基准指数（沪深 300）
  show_progress: true       # 显示进度条


# ============================================================================
# 日志配置
# ============================================================================
log:
  level: INFO                   # DEBUG / INFO / WARNING / ERROR
  format: "%(asctime)s | %(levelname)-8s | %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"
  enable_file_log: true
  log_file: "backtest.log"


# ============================================================================
# 环境变量覆盖示例（命令行设置）
# ============================================================================
# export QUANT_ACCOUNT_INITIAL_CASH=2000000
# export QUANT_DATA_COLLECTOR_MAX_WORKERS=20
# export QUANT_LOG_LEVEL=DEBUG
